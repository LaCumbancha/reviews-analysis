networks:
  testing_net:
    ipam:
      config:
      - subnet: 172.25.125.0/24
      driver: default
services:
  biz_scatter:
    container_name: biz_scatter
    depends_on:
    - citbiz_mapper0
    - citbiz_mapper1
    entrypoint: /scatter
    environment:
    - BIZSCA_BUSINESS_DATA=/data/test-business.json
    - BIZSCA_RABBITMQ_IP=rabbitmq
    - BIZSCA_RABBITMQ_PORT=5672
    - BIZSCA_CITBIZ_MAPPERS=2
    image: biz_scatter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
    volumes:
    - business_dataset:/data
  citbiz_mapper0:
    container_name: citbiz_mapper0
    depends_on: []
    entrypoint: /mapper
    environment:
    - CITBIZMAP_RABBITMQ_IP=rabbitmq
    - CITBIZMAP_RABBITMQ_PORT=5672
    - CITBIZMAP_FUNCIT_JOINERS=2
    image: citbiz_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  citbiz_mapper1:
    container_name: citbiz_mapper1
    depends_on: []
    entrypoint: /mapper
    environment:
    - CITBIZMAP_RABBITMQ_IP=rabbitmq
    - CITBIZMAP_RABBITMQ_PORT=5672
    - CITBIZMAP_FUNCIT_JOINERS=2
    image: citbiz_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_aggregator0:
    container_name: funbiz_aggregator0
    depends_on:
    - funcit_joiner0
    - funcit_joiner1
    entrypoint: /aggregator
    environment:
    - FUNBIZAGG_RABBITMQ_IP=rabbitmq
    - FUNBIZAGG_RABBITMQ_PORT=5672
    - FUNBIZAGG_FUNBIZ_FILTERS=2
    - FUNBIZAGG_FUNCIT_JOINERS=2
    - FUNBIZAGG_INPUT_TOPIC=0
    image: funbiz_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_aggregator1:
    container_name: funbiz_aggregator1
    depends_on:
    - funcit_joiner0
    - funcit_joiner1
    entrypoint: /aggregator
    environment:
    - FUNBIZAGG_RABBITMQ_IP=rabbitmq
    - FUNBIZAGG_RABBITMQ_PORT=5672
    - FUNBIZAGG_FUNBIZ_FILTERS=2
    - FUNBIZAGG_FUNCIT_JOINERS=2
    - FUNBIZAGG_INPUT_TOPIC=1
    image: funbiz_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_filter0:
    container_name: funbiz_filter0
    depends_on:
    - funbiz_aggregator0
    - funbiz_aggregator1
    entrypoint: /filter
    environment:
    - FUNBIZFIL_RABBITMQ_IP=rabbitmq
    - FUNBIZFIL_RABBITMQ_PORT=5672
    - FUNBIZFIL_FUNBIZ_MAPPERS=2
    - FUNBIZFIL_FUNBIZ_AGGREGATORS=2
    image: funbiz_filter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_filter1:
    container_name: funbiz_filter1
    depends_on:
    - funbiz_aggregator0
    - funbiz_aggregator1
    entrypoint: /filter
    environment:
    - FUNBIZFIL_RABBITMQ_IP=rabbitmq
    - FUNBIZFIL_RABBITMQ_PORT=5672
    - FUNBIZFIL_FUNBIZ_MAPPERS=2
    - FUNBIZFIL_FUNBIZ_AGGREGATORS=2
    image: funbiz_filter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_mapper0:
    container_name: funbiz_mapper0
    depends_on:
    - funbiz_filter0
    - funbiz_filter1
    entrypoint: /mapper
    environment:
    - FUNBIZMAP_RABBITMQ_IP=rabbitmq
    - FUNBIZMAP_RABBITMQ_PORT=5672
    - FUNBIZMAP_FUNBIZ_FILTERS=2
    image: funbiz_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funbiz_mapper1:
    container_name: funbiz_mapper1
    depends_on:
    - funbiz_filter0
    - funbiz_filter1
    entrypoint: /mapper
    environment:
    - FUNBIZMAP_RABBITMQ_IP=rabbitmq
    - FUNBIZMAP_RABBITMQ_PORT=5672
    - FUNBIZMAP_FUNBIZ_FILTERS=2
    image: funbiz_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funcit_aggregator0:
    container_name: funcit_aggregator0
    depends_on:
    - sink
    entrypoint: /aggregator
    environment:
    - FUNCITAGG_RABBITMQ_IP=rabbitmq
    - FUNCITAGG_RABBITMQ_PORT=5672
    - FUNCITAGG_FUNCIT_JOINERS=2
    - FUNCITAGG_FUNCIT_FILTERS=2
    - FUNCITAGG_INPUT_TOPIC=0
    image: funcit_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funcit_aggregator1:
    container_name: funcit_aggregator1
    depends_on:
    - sink
    entrypoint: /aggregator
    environment:
    - FUNCITAGG_RABBITMQ_IP=rabbitmq
    - FUNCITAGG_RABBITMQ_PORT=5672
    - FUNCITAGG_FUNCIT_JOINERS=2
    - FUNCITAGG_FUNCIT_FILTERS=2
    - FUNCITAGG_INPUT_TOPIC=1
    image: funcit_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funcit_joiner0:
    container_name: funcit_joiner0
    depends_on:
    - funcit_aggregator0
    - funcit_aggregator1
    entrypoint: /joiner
    environment:
    - FUNCITJOIN_RABBITMQ_IP=rabbitmq
    - FUNCITJOIN_RABBITMQ_PORT=5672
    - FUNCITJOIN_FUNBIZ_AGGREGATORS=2
    - FUNCITJOIN_CITBIZ_MAPPERS=2
    - FUNCITJOIN_FUNCIT_AGGREGATORS=2
    - FUNCITJOIN_INPUT_TOPIC=0
    image: funcit_joiner:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  funcit_joiner1:
    container_name: funcit_joiner1
    depends_on:
    - funcit_aggregator0
    - funcit_aggregator1
    entrypoint: /joiner
    environment:
    - FUNCITJOIN_RABBITMQ_IP=rabbitmq
    - FUNCITJOIN_RABBITMQ_PORT=5672
    - FUNCITJOIN_FUNBIZ_AGGREGATORS=2
    - FUNCITJOIN_CITBIZ_MAPPERS=2
    - FUNCITJOIN_FUNCIT_AGGREGATORS=2
    - FUNCITJOIN_INPUT_TOPIC=1
    image: funcit_joiner:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  mock_receiver0:
    container_name: mock_receiver0
    depends_on:
    - rabbitmq
    entrypoint: /receiver
    environment:
    - MOCK_TYPE=QUEUE
    - MOCK_RABBITMQ_IP=rabbitmq
    - MOCK_RABBITMQ_PORT=5672
    - MOCK_QUEUE=FunnyCityAggregator
    image: mock_receiver:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  rabbitmq:
    container_name: rabbitmq
    healthcheck:
      interval: 10s
      retries: '10'
      test: '["CMD", "curl", "-f", "http://rabbitmq:156722]'
      timeout: 5s
    image: rabbitmq:custom
    logging:
      driver: none
    networks:
    - testing_net
    ports:
    - 15672:15672
  rvw_scatter:
    container_name: rvw_scatter
    depends_on:
    - funbiz_mapper0
    - funbiz_mapper1
    - weekday_mapper0
    - weekday_mapper1
    - user_mapper0
    - user_mapper1
    entrypoint: /scatter
    environment:
    - RVWSCA_REVIEWS_DATA=/data/test-reviews.json
    - RVWSCA_RABBITMQ_IP=rabbitmq
    - RVWSCA_RABBITMQ_PORT=5672
    - RVWSCA_FUNBIZ_MAPPERS=2
    - RVWSCA_WEEKDAYS_MAPPERS=2
    - RVWSCA_HASHES_MAPPERS=1
    - RVWSCA_USERS_MAPPERS=2
    - RVWSCA_STARS_MAPPERS=1
    image: rvw_scatter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
    volumes:
    - reviews_dataset:/data
  sink:
    container_name: sink
    depends_on:
    - mock_receiver0
    entrypoint: /sink
    environment:
    - SINK_RABBITMQ_IP=rabbitmq
    - SINK_RABBITMQ_PORT=5672
    image: sink:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  top_users_prettier:
    container_name: top_users_prettier
    depends_on:
    - sink
    entrypoint: /prettier
    environment:
    - TOPUSERPRE_RABBITMQ_IP=rabbitmq
    - TOPUSERPRE_RABBITMQ_PORT=5672
    - TOPUSERPRE_USER_FILTERS=2
    image: top_users_prettier:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_aggregator0:
    container_name: user_aggregator0
    depends_on:
    - weekday_histogram_prettier
    entrypoint: /aggregator
    environment:
    - USERAGG_RABBITMQ_IP=rabbitmq
    - USERAGG_RABBITMQ_PORT=5672
    - USERAGG_INPUT_TOPIC=0
    - USERAGG_USER_MAPPERS=2
    - USERAGG_USER_FILTERS=2
    image: user_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_aggregator1:
    container_name: user_aggregator1
    depends_on:
    - weekday_histogram_prettier
    entrypoint: /aggregator
    environment:
    - USERAGG_RABBITMQ_IP=rabbitmq
    - USERAGG_RABBITMQ_PORT=5672
    - USERAGG_INPUT_TOPIC=1
    - USERAGG_USER_MAPPERS=2
    - USERAGG_USER_FILTERS=2
    image: user_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_filter0:
    container_name: user_filter0
    depends_on:
    - top_users_prettier
    entrypoint: /filter
    environment:
    - USERFIL_RABBITMQ_IP=rabbitmq
    - USERFIL_RABBITMQ_PORT=5672
    - USERFIL_USER_AGGREGATORS=2
    image: user_filter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_filter1:
    container_name: user_filter1
    depends_on:
    - top_users_prettier
    entrypoint: /filter
    environment:
    - USERFIL_RABBITMQ_IP=rabbitmq
    - USERFIL_RABBITMQ_PORT=5672
    - USERFIL_USER_AGGREGATORS=2
    image: user_filter:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_mapper0:
    container_name: user_mapper0
    depends_on:
    - user_aggregator0
    - user_aggregator1
    entrypoint: /mapper
    environment:
    - USERMAP_RABBITMQ_IP=rabbitmq
    - USERMAP_RABBITMQ_PORT=5672
    - USERMAP_USER_AGGREGATORS=2
    image: user_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  user_mapper1:
    container_name: user_mapper1
    depends_on:
    - user_aggregator0
    - user_aggregator1
    entrypoint: /mapper
    environment:
    - USERMAP_RABBITMQ_IP=rabbitmq
    - USERMAP_RABBITMQ_PORT=5672
    - USERMAP_USER_AGGREGATORS=2
    image: user_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  weekday_aggregator0:
    container_name: weekday_aggregator0
    depends_on:
    - weekday_histogram_prettier
    entrypoint: /aggregator
    environment:
    - WEEKDAYAGG_RABBITMQ_IP=rabbitmq
    - WEEKDAYAGG_RABBITMQ_PORT=5672
    - WEEKDAYAGG_INPUT_TOPIC=0
    - WEEKDAYAGG_WEEKDAY_MAPPERS=2
    image: weekday_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  weekday_aggregator1:
    container_name: weekday_aggregator1
    depends_on:
    - weekday_histogram_prettier
    entrypoint: /aggregator
    environment:
    - WEEKDAYAGG_RABBITMQ_IP=rabbitmq
    - WEEKDAYAGG_RABBITMQ_PORT=5672
    - WEEKDAYAGG_INPUT_TOPIC=1
    - WEEKDAYAGG_WEEKDAY_MAPPERS=2
    image: weekday_aggregator:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  weekday_histogram_prettier:
    container_name: weekday_histogram_prettier
    depends_on:
    - sink
    entrypoint: /prettier
    environment:
    - HISTOPRE_RABBITMQ_IP=rabbitmq
    - HISTOPRE_RABBITMQ_PORT=5672
    - HISTOPRE_WEEKDAY_AGGREGATORS=2
    image: weekday_histogram_prettier:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  weekday_mapper0:
    container_name: weekday_mapper0
    depends_on:
    - weekday_aggregator0
    - weekday_aggregator1
    entrypoint: /mapper
    environment:
    - WEEKDAYMAP_RABBITMQ_IP=rabbitmq
    - WEEKDAYMAP_RABBITMQ_PORT=5672
    - WEEKDAYMAP_WEEKDAY_AGGREGATORS=2
    image: weekday_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
  weekday_mapper1:
    container_name: weekday_mapper1
    depends_on:
    - weekday_aggregator0
    - weekday_aggregator1
    entrypoint: /mapper
    environment:
    - WEEKDAYMAP_RABBITMQ_IP=rabbitmq
    - WEEKDAYMAP_RABBITMQ_PORT=5672
    - WEEKDAYMAP_WEEKDAY_AGGREGATORS=2
    image: weekday_mapper:latest
    links:
    - rabbitmq
    networks:
    - testing_net
    restart: on-failure
version: '3'
volumes:
  business_dataset:
    driver: local
    driver_opts:
      device: $PWD/datasets/business
      o: bind
      type: none
  reviews_dataset:
    driver: local
    driver_opts:
      device: $PWD/datasets/reviews
      o: bind
      type: none
